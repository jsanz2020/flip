<odoo>
    <!-- Vista de formulario mejorada -->
    <record id="view_flipbook_form" model="ir.ui.view">
        <field name="name">website.flipbook.form</field>
        <field name="model">website.flipbook</field>
        <field name="arch" type="xml">
            <form string="Flipbook PDF">
                <header>
                    <button name="regenerate_access_token" 
                            string="Regenerar Token" 
                            type="object" 
                            class="btn-secondary"
                            confirm="¿Está seguro de que desea regenerar el token de acceso? Esto invalidará todos los enlaces existentes."
                            help="Regenera el token de acceso seguro"/>
                    <button name="%(action_flipbook_preview)d" 
                            string="Vista Previa" 
                            type="action" 
                            class="btn-primary"
                            context="{'default_flipbook_id': active_id}"
                            help="Ver el flipbook en el sitio web"/>
                </header>
                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button name="toggle_active" 
                                type="object" 
                                class="oe_stat_button" 
                                icon="fa-archive">
                            <field name="active" widget="boolean_button"/>
                        </button>
                        <button class="oe_stat_button" icon="fa-eye" type="object" name="action_view_stats">
                            <field name="view_count" widget="statinfo" string="Visualizaciones"/>
                        </button>
                    </div>
                    
                    <widget name="web_ribbon" title="Archivado" bg_color="bg-danger" 
                            attrs="{'invisible': [('active', '=', True)]}"/>
                    
                    <group>
                        <group>
                            <field name="name" placeholder="Ej: Catálogo de Productos 2024"/>
                            <field name="company_id" groups="base.group_multi_company"/>
                            <field name="sequence"/>
                            <field name="pdf_filename" readonly="1"/>
                            <field name="file_size" widget="integer" readonly="1" 
                                   string="Tamaño" help="Tamaño del archivo en bytes"/>
                        </group>
                        <group>
                            <field name="is_published" string="Publicado en Website"/>
                            <field name="website_url" widget="url" readonly="1" 
                                   attrs="{'invisible': [('is_published', '=', False)]}"/>
                            <field name="access_token" readonly="1" password="True"/>
                            <field name="last_viewed" readonly="1"/>
                        </group>
                    </group>
                    
                    <group string="Archivo PDF">
                        <field name="pdf_file" 
                               widget="binary" 
                               filename="pdf_filename"
                               options="{'accepted_file_extensions': '.pdf'}"
                               help="Selecciona un archivo PDF válido"/>
                    </group>
                    
                    <group string="Descripción">
                        <field name="description" 
                               placeholder="Descripción opcional del contenido del flipbook"
                               widget="text"
                               nolabel="1"/>
                    </group>
                    
                    <group string="SEO" attrs="{'invisible': [('is_published', '=', False)]}">
                        <field name="website_meta_title"/>
                        <field name="website_meta_description"/>
                        <field name="website_meta_keywords"/>
                    </group>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids"/>
                    <field name="activity_ids"/>
                    <field name="message_ids"/>
                </div>
            </form>
        </field>
    </record>

    <!-- Vista de lista mejorada -->
    <record id="view_flipbook_tree" model="ir.ui.view">
        <field name="name">website.flipbook.tree</field>
        <field name="model">website.flipbook</field>
        <field name="arch" type="xml">
            <tree string="Flipbooks PDF" default_order="sequence, name">
                  decoration-muted="not active"
                  decoration-success="is_published"
                  decoration-warning="not is_published">
                <field name="sequence" widget="handle"/>
                <field name="name"/>
                <field name="pdf_filename"/>
                <field name="company_id" groups="base.group_multi_company" optional="show"/>
                <field name="file_size" widget="integer" string="Tamaño (bytes)" optional="hide"/>
                <field name="view_count" string="Vistas" optional="show"/>
                <field name="is_published" widget="boolean_toggle" string="Publicado"/>
                <field name="active" widget="boolean_toggle"/>
                <field name="create_date" optional="show"/>
                <field name="write_date" optional="hide"/>
                <field name="last_viewed" optional="hide"/>
                <button name="regenerate_access_token" 
                        type="object" 
                        icon="fa-refresh" 
                        title="Regenerar Token"
                        confirm="¿Regenerar el token de acceso?"/>
            </tree>
        </field>
    </record>

    <!-- Vista de búsqueda -->
    <record id="view_flipbook_search" model="ir.ui.view">
        <field name="name">website.flipbook.search</field>
        <field name="model">website.flipbook</field>
        <field name="arch" type="xml">
            <search string="Buscar Flipbooks">
                <field name="name" string="Nombre" 
                       filter_domain="[('name', 'ilike', self)]"/>
                <field name="description" string="Descripción"/>
                <field name="pdf_filename" string="Archivo"/>
                <field name="company_id" groups="base.group_multi_company"/>
                
                <filter string="Publicados" name="published" 
                        domain="[('is_published', '=', True)]"/>
                <filter string="No Publicados" name="not_published" 
                        domain="[('is_published', '=', False)]"/>
                <filter string="Activos" name="active" 
                        domain="[('active', '=', True)]"/>
                <filter string="Archivados" name="inactive" 
                        domain="[('active', '=', False)]"/>
                <filter string="Con Visualizaciones" name="has_views" 
                        domain="[('view_count', '>', 0)]"/>
                <filter string="Sin Visualizaciones" name="no_views" 
                        domain="[('view_count', '=', 0)]"/>
                
                <separator/>
                <filter string="Creados Hoy" name="today" 
                        domain="[('create_date', '>=', datetime.datetime.combine(context_today(), datetime.time(0,0,0)))]"/>
                <filter string="Creados Esta Semana" name="week" 
                        domain="[('create_date', '>=', (context_today() - datetime.timedelta(days=7)).strftime('%Y-%m-%d'))]"/>
                <filter string="Visualizados Hoy" name="viewed_today" 
                        domain="[('last_viewed', '>=', datetime.datetime.combine(context_today(), datetime.time(0,0,0)))]"/>
                
                <group expand="0" string="Agrupar Por">
                    <filter string="Estado de Publicación" name="group_published" 
                            context="{'group_by': 'is_published'}"/>
                    <filter string="Fecha de Creación" name="group_create_date" 
                            context="{'group_by': 'create_date:month'}"/>
                    <filter string="Empresa" name="group_company" 
                            context="{'group_by': 'company_id'}" 
                            groups="base.group_multi_company"/>
                </group>
            </search>
        </field>
    </record>

    <!-- Vista kanban -->
    <record id="view_flipbook_kanban" model="ir.ui.view">
        <field name="name">website.flipbook.kanban</field>
        <field name="model">website.flipbook</field>
        <field name="arch" type="xml">
            <kanban default_group_by="is_published" class="o_kanban_small_column" quick_create="false">
                <field name="id"/>
                <field name="name"/>
                <field name="description"/>
                <field name="pdf_filename"/>
                <field name="is_published"/>
                <field name="active"/>
                <field name="view_count"/>
                <field name="file_size"/>
                <field name="create_date"/>
                <field name="company_id"/>
                
                <templates>
                    <t t-name="kanban-box">
                        <div class="oe_kanban_card oe_kanban_global_click" 
                             t-att-class="!record.active.raw_value ? 'oe_kanban_color_2' : ''">
                            <div class="o_kanban_image">
                                <i class="fa fa-file-pdf-o fa-3x" 
                                   t-att-class="record.is_published.raw_value ? 'text-success' : 'text-muted'"/>
                            </div>
                            <div class="oe_kanban_details">
                                <strong class="o_kanban_record_title">
                                    <field name="name"/>
                                </strong>
                                <div class="o_kanban_record_body">
                                    <field name="description"/>
                                    <div class="mt-2" t-if="record.file_size.raw_value">
                                        <small class="text-muted">
                                            <i class="fa fa-file-o"/> 
                                            <t t-esc="Math.round(record.file_size.raw_value / 1024)"/> KB
                                        </small>
                                    </div>
                                </div>
                                <div class="o_kanban_record_bottom">
                                    <div class="oe_kanban_bottom_left">
                                        <span class="badge badge-pill badge-info" 
                                              t-if="record.pdf_filename.value">
                                            <i class="fa fa-file"/> 
                                            <t t-esc="record.pdf_filename.value"/>
                                        </span>
                                        <span class="badge badge-pill badge-secondary ml-1" 
                                              t-if="record.view_count.raw_value">
                                            <i class="fa fa-eye"/> 
                                            <t t-esc="record.view_count.value"/>
                                        </span>
                                    </div>
                                    <div class="oe_kanban_bottom_right">
                                        <span class="badge badge-success" 
                                              t-if="record.is_published.raw_value and record.active.raw_value">
                                            Publicado
                                        </span>
                                        <span class="badge badge-secondary" 
                                              t-if="!record.is_published.raw_value">
                                            No Publicado
                                        </span>
                                        <span class="badge badge-warning" 
                                              t-if="!record.active.raw_value">
                                            Archivado
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <div class="oe_kanban_footer">
                                <div class="o_kanban_footer_left">
                                    <small class="text-muted">
                                        Creado: <t t-esc="record.create_date.value"/>
                                    </small>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <!-- Acción para vista previa -->
    <record id="action_flipbook_preview" model="ir.actions.act_url">
        <field name="name">Vista Previa del Flipbook</field>
        <field name="url">/flipbook/view/%(flipbook_id)s</field>
        <field name="target">new</field>
    </record>
    <!-- Acción de ventana -->
    <record id="action_flipbook" model="ir.actions.act_window">
        <field name="name">Flipbooks PDF</field>
        <field name="res_model">website.flipbook</field>
        <field name="view_mode">kanban,tree,form</field>
        <field name="context">{'search_default_active': 1, 'search_default_published': 1}</field>
        <field name="domain">[]</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                ¡Crea tu primer Flipbook PDF!
            </p>
            <p>
                Los flipbooks te permiten mostrar documentos PDF como libros interactivos 
                en tu sitio web con efectos de página realistas.
            </p>
            <p>
                <strong>Características:</strong>
            </p>
            <ul>
                <li>Visualización interactiva con efectos de página</li>
                <li>Responsive y compatible con dispositivos móviles</li>
                <li>Controles de navegación intuitivos</li>
                <li>Seguimiento de visualizaciones</li>
                <li>Acceso seguro mediante tokens</li>
            </ul>
        </field>
    </record>

    <!-- Menú -->
    <menuitem id="menu_flipbook"
              name="Flipbooks PDF" 
              parent="website.menu_website_configuration"
              action="action_flipbook"
              sequence="50"/>
              
    <!-- Submenú para estadísticas -->
    <menuitem id="menu_flipbook_stats"
              name="Estadísticas" 
              parent="menu_flipbook"
              action="action_flipbook_stats"
              sequence="10"/>
</odoo>